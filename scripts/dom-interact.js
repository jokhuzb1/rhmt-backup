const faqData = {
  items: [
    {
      question_uz:
        "Rahmat Business nima va u mening muassasama qanday yordam berishi mumkin?",
      question_ru:
        "Что такое Rahmat Business и как он может помочь моему заведению?",
      question_en:
        "What is Rahmat Business, and how can it help my establishment?",
      answer_uz:
        "Rahmat Business — bu Rahmat xizmatining aynan kompaniya rahbarlari uchun mo‘ljallangan bo‘limi bo‘lib, u Rahmat xizmatining hamkori hisoblanadi. U qulay boshqaruv panelini, filiallar boshqaruvini, umumiy hisobot va tahlilni hamda har bir to‘lov usuli bo‘yicha tushumlar nazoratini taqdim etadi. Bu sizga biznesingizni kuzatish va yaxshilash imkoniyatini beradi.",
      answer_ru:
        "Rahmat Business — это раздел сервиса Rahmat, разработанный специально для руководителей компании, являющегося партнером сервиса Rahmat. Он предоставляет удобную админ-панель, управление филиалами, сводную отчетность и аналитику, а также контроль поступлений по каждому методу платежа. Это поможет вам отслеживать и улучшать работу вашего бизнеса.",
      answer_en:
        "Rahmat Business is a dedicated section of the Rahmat service, developed specifically for business managers partnered with Rahmat. It offers a user-friendly admin panel, branch management, summary reporting and analytics, and control over revenue by each payment method. This helps you monitor and improve your business performance.",
    },
    {
      question_uz:
        "Rahmat Business xizmatiga ulanish uchun qanday qadamlarni bajarish kerak?",
      question_ru:
        "Какие шаги нужно предпринять для подключения к Rahmat Business?",
      question_en: "What steps should I take to connect to Rahmat Business?",
      answer_uz:
        "Rahmat Business xizmatiga ulanish uchun saytimizda ro‘yxatdan o‘tish formasini to‘ldiring. Bizning menejerimiz siz bilan bog‘lanib, xizmatni sizning muassasangiz talablariga mos ravishda o‘rnatadi va sozlaydi, shuningdek, tizim bilan ishlash bo‘yicha xodimlarni o‘qitadi.",
      answer_ru:
        "Для подключения к Rahmat Business заполните форму регистрации на сайте. Наш менеджер свяжется с вами, чтобы провести установку и настройку сервиса под нужды вашего заведения, а также обучить персонал работе с системой.",
      answer_en:
        "To connect to Rahmat Business, fill out the registration form on the website. Our manager will contact you to install and set up the service tailored to your establishment’s needs and train staff on using the system.",
    },
    {
      question_uz: "Xodimlar uchun qanday darajadagi kirish huquqlari mavjud?",
      question_ru: "Какие уровни доступа предусмотрены для сотрудников?",
      question_en: "What levels of access are available for employees?",
      answer_uz:
        "Rahmat Business turli darajadagi kirish huquqlarini taqdim etadi, ular xodimning lavozimi va vazifalariga ko‘ra sozlanishi mumkin. Administrator filiallarni boshqarish va hisobotlarga to‘liq kirish huquqiga ega bo‘lsa, kassirlar va boshqa xodimlar cheklangan huquqlarga ega bo‘ladilar.",
      answer_ru:
        "В Rahmat Business предусмотрены разные уровни доступа, которые можно настраивать в зависимости от должности и функций сотрудника. Администратор имеет полный доступ, включая управление филиалами и отчетами, а кассиры и другие сотрудники получают ограниченные права.",
      answer_en:
        "Rahmat Business offers different access levels that can be configured based on the position and role of each employee. The administrator has full access, including branch and report management, while cashiers and other staff have limited permissions.",
    },
    {
      question_uz: "Rahmat xizmati qanchalik xavfsiz?",
      question_ru: "Насколько безопасен сервис Rahmat?",
      question_en: "How secure is the Rahmat service?",
      answer_uz:
        "Biz mijozlarimiz ma'lumotlarini himoya qilishga katta ahamiyat beramiz. Rahmat Business ko‘p darajali himoya tizimidan foydalanadi, tizimga kirish faqat ishonchli parollar va xavfsiz ulanish orqali amalga oshiriladi.",
      answer_ru:
        "Безопасность данных наших клиентов — наш приоритет. Rahmat Business использует многоуровневую систему защиты данных, а доступ к системе возможен только через авторизацию с использованием надежных паролей и защищенных соединений.",
      answer_en:
        "The security of our clients’ data is our priority. Rahmat Business employs a multi-level data protection system, with access only available through secure connections and strong password authentication.",
    },
    {
      question_uz:
        "Men bir hisob orqali har bir filialning ishini nazorat qila olamanmi?",
      question_ru:
        "Могу ли я контролировать работу каждого филиала через один аккаунт?",
      question_en:
        "Can I monitor each branch’s performance through a single account?",
      answer_uz:
        "Ha, Rahmat Business barcha filiallarni bir boshqaruv paneli orqali boshqarish imkoniyatini beradi. Siz filiallarni yoqish yoki o‘chirish, ularning faolligi va tushumlarini nazorat qilish hamda har bir filial bo‘yicha umumiy hisobotlarni olish imkoniyatiga egasiz.",
      answer_ru:
        "Да, Rahmat Business предоставляет возможность управления всеми филиалами через одну админ-панель. Вы можете включать или выключать филиалы, контролировать их активность и обороты, получать сводные отчеты по каждому филиалу.",
      answer_en:
        "Yes, Rahmat Business allows you to manage all branches through a single admin panel. You can enable or disable branches, monitor their activity and revenue, and get summary reports for each branch.",
    },
    {
      question_uz:
        "Rahmat Business qaysi to‘lov usullarini qo‘llab-quvvatlaydi?",
      question_ru: "Какие методы платежей поддерживает Rahmat Business?",
      question_en: "What payment methods does Rahmat Business support?",
      answer_uz:
        "Xizmat barcha asosiy to‘lov usullarini, jumladan QR-kod orqali to‘lov, kartalar va boshqa elektron usullarni qo‘llab-quvvatlaydi. Barcha tushumlar real vaqt rejimida tizimda ko‘rinadi.",
      answer_ru:
        "Сервис поддерживает все основные методы оплаты, включая оплату по QR-коду, карты, и другие электронные способы. Все поступления отображаются в системе в реальном времени.",
      answer_en:
        "The service supports all major payment methods, including QR code payments, cards, and other electronic options. All incoming payments are displayed in real time in the system.",
    },
    {
      question_uz:
        "Rahmat Business mijozlarning sharhlarini boshqarishda qanday yordam beradi?",
      question_ru:
        "Как Rahmat Business помогает в управлении отзывами клиентов?",
      question_en:
        "How does Rahmat Business assist with managing customer feedback?",
      answer_uz:
        "Tizim avtomatik ravishda mijozlarning sharhlarini yig‘adi va tahlil qiladi, ularga oid umumiy hisobotlarni shakllantiradi. Salbiy sharhlar soni oshgan taqdirda, xizmat savdo nuqtalari bilan ishlashni yaxshilash uchun tavsiyalar beradi.",
      answer_ru:
        "Система автоматически собирает и анализирует отзывы клиентов, формируя сводную отчетность по ним. В случае увеличения отрицательных отзывов сервис предложит рекомендации для улучшения работы с точками продаж.",
      answer_en:
        "The system automatically collects and analyzes customer feedback, creating summary reports. If negative feedback increases, the service will provide recommendations to improve interactions at sales points.",
    },
    {
      question_uz:
        "Rahmat boshqa boshqaruv dasturlari bilan integratsiya qilinishi mumkinmi?",
      question_ru:
        "Можно ли интегрировать Rahmat с другими программами управления?",
      question_en: "Can Rahmat be integrated with other management software?",
      answer_uz:
        "Rahmat Business biznesingizni olib borish qulay bo‘lishi uchun mashhur hisob-kitob va boshqaruv tizimlari bilan integratsiya qilish imkoniyatini taqdim etadi. Qo‘shimcha integratsiyalar haqida ma'lumot olish uchun bizning menejerimiz bilan bog‘laning.",
      answer_ru:
        "Rahmat Business поддерживает интеграцию с популярными системами учета и управления для удобства ведения бизнеса. Свяжитесь с нашим менеджером для уточнения доступных интеграций.",
      answer_en:
        "Rahmat Business supports integration with popular accounting and management systems to facilitate business operations. Contact our manager for details on available integrations.",
    },
    {
      question_uz: "Tizim qanday hisobotlarni yaratishi mumkin?",
      question_ru: "Какие отчеты может генерировать система?",
      question_en: "What reports can the system generate?",
      answer_uz:
        "Rahmat Business savdolar, sharhlar, filiallar faolligi va har bir to‘lov usuli bo‘yicha turli hisobotlarni taqdim etadi. Hisobotlarning davriyligini sozlash va ular uchun qulay formatda olish imkoniyati mavjud.",
      answer_ru:
        "Rahmat Business предоставляет различные отчеты по продажам, отзывам, активности филиалов и каждому методу оплаты. Можно настроить периодичность отчетов и получить их в удобном формате.",
      answer_en:
        "Rahmat Business offers various reports on sales, feedback, branch activity, and each payment method. You can configure the report frequency and download them in a convenient format.",
    },
    {
      question_uz:
        "Rahmat Business foydalanuvchilari uchun texnik qo‘llab-quvvatlash mavjudmi?",
      question_ru:
        "Есть ли техническая поддержка для пользователей Rahmat Business?",
      question_en: "Is there technical support for Rahmat Business users?",
      answer_uz:
        "Ha, biz ish vaqtida barcha mijozlarimiz uchun yuqori ustuvorlikda texnik qo‘llab-quvvatlashni taklif qilamiz. Bizning mutaxassislarimiz barcha masalalar bo‘yicha yordam beradi va xizmatning barcha imkoniyatlari bo‘yicha maslahat berishadi.",
      answer_ru:
        "Да, мы предлагаем техническую поддержку в рабочие часы  для всех клиентов с высоким приориетом. Наши специалисты помогут в решении любых вопросов и консультируют по всем возможностям сервиса.",
      answer_en:
        "Yes, we offer priority technical support during working hours for all clients. Our specialists will assist with any issues and advise on all the service's features.",
    },
  ],
};

export const InteractWithDom = async (b) => {
  try {
    console.log("Function is loading");
    const $ = (selector) => document.querySelector(selector);
    const $$ = (selector) => document.querySelectorAll(selector);

    const allDropDownButtons = $$(".dropdownButton");
    const mainMenu = $(".main-menu");
    const mainMenuLinks = $$(".main-menu a");
    const burgerButton = $(".burger-icon");
    const closeMenuButton = $(".menu-close-icon");
    const toDownBtn = $("#toDownBtn");
    const toTopBtn = $("#toTopBtn");
    const nextSectionButtons = $$(".scrollToNextButtonMobile");
    const faqButtonsContainer = $("#faqButtons");
    const faqContentContainer = $("#faqContent");
    let currentCategoryIdx = 0;
    let currentLang = localStorage.getItem("selectedLanguage");
    let data = null;

    allDropDownButtons?.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const chevronIcon = btn.querySelector(".chevronIcon");
        chevronIcon?.classList.toggle("rotate-180");
        btn.classList.toggle("active");
      });

      window.addEventListener("click", () => {
        const chevronIcon = btn.querySelector(".chevronIcon");
        chevronIcon?.classList.remove("rotate-180");
        btn.classList.remove("active");
      });
    });

    burgerButton?.addEventListener("click", (e) => {
      mainMenu?.classList.toggle("active");
      e.stopPropagation();
    });

    mainMenu?.addEventListener("click", (e) => e.stopPropagation());
    closeMenuButton?.addEventListener("click", () =>
      mainMenu?.classList.remove("active")
    );

    mainMenuLinks?.forEach((link) => {
      link.addEventListener("click", () =>
        mainMenu?.classList.remove("active")
      );
    });

    window.addEventListener("click", () =>
      mainMenu?.classList.remove("active")
    );

    toDownBtn?.addEventListener("click", () => {
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    });

    toTopBtn?.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    nextSectionButtons?.forEach((btn) => {
      btn.addEventListener("click", () => {
        window.scrollBy({ top: window.innerHeight, behavior: "smooth" });
      });
    });

    const fetchData = async () => {
      try {
        const response = await axios.get(
          "https://rahmatback.pythonanywhere.com/api/get_faq/"
        );
        if (b) {
          data = faqData;
          renderFAQContent(faqData);
        } else {
          data = response.data;
          renderCategories(data);
          renderFAQContent(data[currentCategoryIdx]);
        }
        addAnimation();
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    };

    window.addEventListener("languageChange", (e) => {
      currentLang = e.detail.language;
      if (b) {
        renderFAQContent(data);
        addAnimation();
      } else {
        renderCategories(data);
        renderFAQContent(data[currentCategoryIdx]);
      }
    });

    const getTextByLang = (details, field) => {
      const currentDetail = details?.[`${field}_${currentLang}`] || "en";
      return currentDetail;
    };

    const renderCategories = (data) => {
      if (faqButtonsContainer) {
        faqButtonsContainer.innerHTML = "";
      }

      data.forEach((category, index) => {
        const button = document.createElement("button");
        button.className = `btn big ${
          currentCategoryIdx === index ? "dark" : "white"
        } select-btn`;
        button.innerText = getTextByLang(category, "name");

        button.addEventListener("click", () => {
          currentCategoryIdx = index;
          renderFAQContent(data[currentCategoryIdx]);
          updateButtons(data);
          addAnimation();
        });
        if (faqButtonsContainer) {
          faqButtonsContainer.appendChild(button);
        }
      });
    };

    const renderFAQContent = (category) => {
      if (!faqContentContainer) {
        console.log("faqContentContainer not found in the DOM.");
        return;
      }
      faqContentContainer.innerHTML = "";
      if (!category?.items) return;

      category.items.forEach((details, index) => {
        const detailsElement = document.createElement("details");
        detailsElement.className =
          "py-[30px] px-[40px]  max-md:border-b-[1px] max-md:border-b-[#88888880] max-md:pb-[15px]";
        detailsElement.style = "padding:15px 20px;width:100%";
        detailsElement.innerHTML = `
          <summary class="flex justify-between items-center">
            <div class="flex items-center justify-between w-full">
            <div class="flex items-center gap-5">
              <h3 class="max-md:hidden text-[16px] mr-2">${
                index < 9 ? "0" : ""
              }${index + 1}</h3>
              <h1
                class="text-[30px] max-w-[550px] max-lg:text-[25px] max-sm:text-[16px] max-sm:max-w-[200px]"
              >
                ${getTextByLang(details, "question")}
              </h1>
              </div>
              <div>
                <button class="icon-btn white plus">
                  <img src="./assets/icons/plus-icon.svg" alt="plus" />
                </button>
                <button class="icon-btn minus" style="display: none;">
                  <img src="./assets/icons/minus-icon.svg" alt="minus" />
                </button>
              </div>
            </div>
          </summary>
          <div class="content flex justify-between items-center">
            <div class="max-md:hidden"></div>
            <div class="max-w-[430px] w-full">
              <p class=" w-full max-sm:text-[12px]">
                ${getTextByLang(details, "answer")}
              </p>
            </div>
          </div>
        `;

        faqContentContainer.appendChild(detailsElement);
      });
    };

    const updateButtons = () => {
      faqButtonsContainer
        .querySelectorAll("button")
        .forEach((button, index) => {
          button.className = `btn big ${
            currentCategoryIdx === index ? "dark" : "white"
          }`;
        });
    };

    const addAnimation = () => {
      document.querySelectorAll("details").forEach((el) => {
        const summary = el.querySelector("summary");
        const content = el.querySelector(".content");
        const plusBtn = el.querySelector(".plus");
        const minusBtn = el.querySelector(".minus");

        summary.addEventListener("click", (e) => {
          e.preventDefault();
          if (el.open) {
            slideUp(content, () => {
              el.open = false;
              plusBtn.style.display = "block";
              minusBtn.style.display = "none";
            });
          } else {
            el.open = true;
            plusBtn.style.display = "none";
            minusBtn.style.display = "block";
            slideDown(content);
          }
        });
      });
    };

    const slideUp = (element, callback) => {
      element.style.height = element.offsetHeight + 45 + "px";
      element.offsetHeight;
      element.style.height = "0";
      element.style.paddingTop = "0";

      element.addEventListener("transitionend", function handler() {
        element.removeEventListener("transitionend", handler);
        callback();
      });
    };

    const slideDown = (element) => {
      element.style.height = "0";
      element.offsetHeight;

      const paddingTop = window.innerWidth <= 600 ? "20px" : "40px";
      element.style.height =
        element.scrollHeight + parseInt(paddingTop) + 5 + "px";
      element.style.paddingTop = paddingTop;

      element.addEventListener("transitionend", function handler() {
        element.removeEventListener("transitionend", handler);
        element.style.height = "auto";
      });
    };

    await fetchData();
    console.log("Function is ready");
  } catch (err) {
    console.error("Error from DOM interaction:", err);
    throw err;
  }
};
